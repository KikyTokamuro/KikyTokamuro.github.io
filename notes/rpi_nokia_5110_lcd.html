<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Raspberry Pi + Nokia 5110 LCD = ❤</title>
<meta name="generator" content="Org Mode" />
<link rel="icon" href="../static/favicon.ico">
<link rel="stylesheet" href="../static/org.css" />
</head>
<body>
<div id="content" class="content">
<h1 class="title">Raspberry Pi + Nokia 5110 LCD = ❤</h1>

<div id="org7b2f9f4" class="figure">
<p><img src="../static/rpi_nokia_lcd.png" alt="rpi_nokia_lcd.png" width="300" />
</p>
</div>

<p>
Nokia 5110 LCD — это монохромный дисплей 84x48 пикселей, который использовался в старых телефонах Nokia. Основное преимущество этого дисплея — легкость в управлении.
</p>

<p>
На плате модуля дисплея расположены два параллельных ряда по 8 пинов для подключения и передачи данных:
</p>

<ol class="org-ol">
<li>RST — Перезагрузка.</li>
<li>CE — Выбор чипа.</li>
<li>DC — Выбор режима.</li>
<li>DIN — Вход данных.</li>
<li>CLK — Вход тактового сигнала.</li>
<li>VCC — Питание.</li>
<li>LIGHT — Питание подсветки дисплея.</li>
<li>GND — Земля.</li>
</ol>


<div id="org41102e3" class="figure">
<p><img src="../static/lcd_pins.png" alt="lcd_pins.png" width="300" />
</p>
</div>

<p>
Подключение данного дисплея к Raspberry Pi осуществляется очень просто, вот по этой схеме (чтобы при подключении дисплея работала его подсветка, нужно пин LIGHT подключить на землю):
</p>


<div id="orgce3ecca" class="figure">
<p><img src="../static/lcd_scheme.png" alt="lcd_scheme.png" width="700" />
</p>
</div>

<p>
Дальше для взаимодействия с дисплеем на Raspberry Pi нужно установить нужные библиотеки (предполагается что такие вещи как git, python-pip, python-dev, build-essential у вас уже установлены, если нет, то их тоже нужно установить):
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo apt install python-imaging
pip install RPi.GPIO
</pre>
</div>

<p>
Так как взаимодействие с модулем экрана осуществляется по SPI, его так же нужно включить на Raspberry Pi. Для этого открываем файл "/boot/config.txt" и раскомментируем в нем строку:
</p>
<pre class="example">
dtparam=spi=on
</pre>

<p>
После этого сохраняем файл и перезагружаемся командой:
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo reboot
</pre>
</div>

<p>
Чтобы проверить что SPI включено, можно воспользоваться командой:
</p>
<div class="org-src-container">
<pre class="src src-sh">lsmod | grep <span class="org-string">"spi_bcm*"</span>
</pre>
</div>

<p>
Дальше скачиваем и устанавливаем библиотеку для взаимодействия с дисплеем Nokia 5110:
</p>
<div class="org-src-container">
<pre class="src src-sh">git clone https://github.com/adafruit/Adafruit_Nokia_LCD
<span class="org-builtin">cd</span> Adafruit_Nokia_LCD
sudo python setup.py install
</pre>
</div>

<p>
Чтобы проверить то что дисплей правильно подключен и все работает, можно запустить один из примеров, из папки “Adafruit<sub>Nokia</sub><sub>LCD</sub>/examples/”.
</p>

<p>
А теперь попробуем написать простенькие часы для этого дисплея:
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/python</span>

<span class="org-keyword">import</span> time
<span class="org-keyword">from</span> datetime <span class="org-keyword">import</span> datetime

<span class="org-keyword">import</span> Adafruit_Nokia_LCD <span class="org-keyword">as</span> LCD
<span class="org-keyword">import</span> Adafruit_GPIO.SPI <span class="org-keyword">as</span> SPI

<span class="org-keyword">from</span> PIL <span class="org-keyword">import</span> Image
<span class="org-keyword">from</span> PIL <span class="org-keyword">import</span> ImageDraw
<span class="org-keyword">from</span> PIL <span class="org-keyword">import</span> ImageFont

<span class="org-comment-delimiter"># </span><span class="org-comment">Raspberry Pi hardware SPI config:</span>
<span class="org-variable-name">DC</span> <span class="org-operator">=</span> 23
<span class="org-variable-name">RST</span> <span class="org-operator">=</span> 24
<span class="org-variable-name">SPI_PORT</span> <span class="org-operator">=</span> 0
<span class="org-variable-name">SPI_DEVICE</span> <span class="org-operator">=</span> 0

<span class="org-comment-delimiter"># </span><span class="org-comment">Hardware SPI usage:</span>
<span class="org-variable-name">disp</span> <span class="org-operator">=</span> LCD.PCD8544(DC, RST, spi<span class="org-operator">=</span>SPI.SpiDev(SPI_PORT, SPI_DEVICE, max_speed_hz<span class="org-operator">=</span>4000000))

<span class="org-comment-delimiter"># </span><span class="org-comment">Software SPI usage (defaults to bit-bang SPI interface):</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">disp = LCD.PCD8544(DC, RST, SCLK, DIN, CS)</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">Initialize library.</span>
disp.begin(contrast<span class="org-operator">=</span>40)

<span class="org-comment-delimiter"># </span><span class="org-comment">Clear display.</span>
disp.clear()
disp.display()

<span class="org-comment-delimiter"># </span><span class="org-comment">Create blank image for drawing.</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">Make sure to create image with mode '1' for 1-bit color.</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> Image.new(<span class="org-string">'1'</span>, (LCD.LCDWIDTH, LCD.LCDHEIGHT))

<span class="org-comment-delimiter"># </span><span class="org-comment">Get drawing object to draw on image.</span>
<span class="org-variable-name">draw</span> <span class="org-operator">=</span> ImageDraw.Draw(image)

<span class="org-builtin">print</span>(<span class="org-string">'Press Ctrl-C to quit.'</span>)

<span class="org-keyword">while</span> <span class="org-constant">True</span>:
    <span class="org-comment-delimiter"># </span><span class="org-comment">Get current time</span>
    <span class="org-variable-name">strt</span> <span class="org-operator">=</span> datetime.now().strftime(<span class="org-string">'%H:%M:%S'</span>)

    <span class="org-comment-delimiter"># </span><span class="org-comment">Draw a white filled box to clear the image.</span>
    draw.rectangle((0,0,LCD.LCDWIDTH,LCD.LCDHEIGHT), outline<span class="org-operator">=</span>255, fill<span class="org-operator">=</span>255)

    <span class="org-comment-delimiter"># </span><span class="org-comment">Alternatively load a TTF font.</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">Some nice fonts to try: http://www.dafont.com/bitmap.php</span>
    <span class="org-variable-name">font</span> <span class="org-operator">=</span> ImageFont.truetype(<span class="org-string">'game_over.ttf'</span>, 58)

    <span class="org-comment-delimiter"># </span><span class="org-comment">Write some text.</span>
    draw.text((0,0), strt, font<span class="org-operator">=</span>font)

    <span class="org-comment-delimiter"># </span><span class="org-comment">Display image.</span>
    disp.image(image)
    disp.display()

    time.sleep(1.0)
</pre>
</div>

<p>
Запускается этот код командой:
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo python clock.py
</pre>
</div>

<p>
Демонстрация работы получившихся часов: 
</p>
<iframe width="100%" height="500" src="https://www.youtube.com/embed/Pj_oeo0m8-s" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>
<div id="postamble" class="status">
<p class="creator">Made with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 29.3 (<a href="https://orgmode.org/">Org</a> mode 9.6.15)</p>
</div>
</body>
</html>
